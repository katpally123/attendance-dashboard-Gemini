<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

  <!-- Updated title + favicon -->
  <title>PXT Phoenix — Attendance Dashboard</title>
  <link rel="icon" type="image/png" href="assets/yhm2-logo.png"/>

  <link rel="stylesheet" href="style.css"/>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <script defer src="ops.js"></script>
  <script defer src="config.js"></script>
  <script defer src="site-split.js"></script>
  <script defer src="audit-enhanced.js"></script>
  <script defer src="app.js"></script>
</head>
<body>
  <header>
    <!-- Left: Logo + Name + Version -->
    <div class="logo" style="display:flex;align-items:center;gap:10px;">
      <img src="assets/yhm2-logo.png" alt="YHM2 logo" style="width:36px;height:36px;object-fit:contain"/>
      <div style="display:flex;align-items:center;gap:8px;">
        <span>YHM2 PHOENIX - V2</span>
      </div>
    </div>

    <!-- Middle: Navigation tabs -->
    <nav class="tabs">
      <button id="tabDashboard" class="tab active">Dashboard</button>
      <button id="tab-siteSplit" class="tab">Site Split</button>
      <button id="tabAudit" class="tab">Audit</button>
      <button id="tabOps" class="tab tab-disabled" disabled title="Ops tab locked">
        Ops
        <svg style="width:12px;height:12px;margin-left:4px;" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd"/>
        </svg>
      </button>
    </nav>

    <!-- Right: Status + Buttons -->
    <div class="actions">
      <span id="fileStatus" class="chip chip-muted">Ready</span>
      <button id="processBtn" class="btn">Process Files</button>
    </div>
  </header>

  <main>
    <section class="card">
      <div class="row controls">
        <div>
          <label for="dateInput">Date</label>
          <input type="date" id="dateInput">
        </div>
        <div>
          <label for="shiftInput">Shift</label>
          <select id="shiftInput">
            <option value="Day">Day</option>
            <option value="Night">Night</option>
          </select>
        </div>
        <div class="grow"></div>
        <label class="nh"><input type="checkbox" id="excludeNewHires" checked> Exclude new hires (&lt; 3 days)</label>
      </div>

      <div class="row uploads">
        <label class="file">Roster <input type="file" id="rosterFile" accept=".csv" /></label>
        <label class="file">MyTime (CAN Daily Attendance) <input type="file" id="mytimeFile" accept=".csv" /></label>
        <label class="file">CAN Daily Hours Summary (Vacation/BH) <input type="file" id="vacFile" accept=".csv" /></label>
        <label class="file">Shift Swap — Out <input type="file" id="swapOutFile" accept=".csv" /></label>
        <label class="file">Shift Swap — In <input type="file" id="swapInFile" accept=".csv" /></label>
        <label class="file">VET / VTO (PostingAcceptance) <input type="file" id="vetFile" accept=".csv" /></label>
      </div>
    </section>

    <!-- DASHBOARD -->
    <section id="panelDashboard" class="card">
      <div class="row ribbon">
        <div class="chip">Day: <b id="chipDay">—</b></div>
        <div class="chip">Shift: <b id="chipShift">—</b></div>
        <div class="chip">Corners: <b id="chipCorners">—</b> <span id="chipCornerSource" class="chip-note"></span></div>

        <a id="chipVacation" class="chip chip-link" href="#" download="vacation_excluded.csv" title="Download vacation excluded list (CSV)">Vacation excluded: <b id="chipVacationCount">0</b></a>
        <a id="chipBH" class="chip chip-link" href="#" download="banked_holiday_excluded.csv" title="Download banked holiday excluded list (CSV)">Banked Holiday excluded: <b id="chipBHCount">0</b></a>
      </div>

      <h2 class="card-title">Dept × AMZN/TEMP (Inbound, DA, ICQA, CRETs)</h2>
      <div class="table-wrapper">
        <table id="replicaTable" class="table"></table>
      </div>
    </section>

    <!-- AUDIT -->
    <section id="panelAudit" class="card hidden">
      <div class="row">
        <h2 class="card-title">Absence Audit</h2>
        <div class="grow"></div>
        <button id="dlAuditCSV" class="btn">Download Audit CSV</button>
      </div>
      <p class="hint">Breakdown of scheduled associates who did not show, grouped by reason (mutually exclusive: Vacation &gt; Banked Holiday &gt; VTO &gt; Swap-Out &gt; VET-not-shown &gt; No-Show).</p>
      <div class="table-wrapper">
        <table id="auditTable" class="table"></table>
      </div>
    </section>

    <!-- OPS -->
    <section id="panelOps" class="card hidden">
      <div class="row">
        <h2 class="card-title">Operations Dashboard</h2>
        <div class="grow"></div>
      </div>
      <p class="hint">Planned vs Present headcount by shift code for YDD2-CRETS and YHM2-Inbound/Outbound operations. Includes Swap In/Out, VET, and VTO adjustments.</p>
      <div id="opsTableContainer"></div>
    </section>

    <!-- SITE SPLIT -->
    <section id="siteSplitPage" class="card hidden">
      <h2 class="card-title">Site × AMZN/TEMP (YHM2-SDC, ICQA, YDD2-IXD, Other)</h2>
      <div style="display:flex; align-items:center; gap:12px; margin-bottom:12px;">
        <button id="downloadSiteSplitTemplate" class="btn">
          <svg style="width:14px;height:14px;margin-right:6px;display:inline-block;vertical-align:middle;" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd"/>
          </svg>
          Export Attendance Report
        </button>
      </div>
      <div class="table-wrapper">
        <table id="siteSplitTable" class="table"></table>
      </div>
    </section>
  </main>
</body>
</html>
